try{window.AudioContext=window.AudioContext||window.webkitAudioContext,window.audioContext=new window.AudioContext,isWebAudioAPIEnabled=!0}catch(e){isWebAudioAPIEnabled=!1}var WebAudioAPISoundManager=function(context){this.context=context,this.bufferList={},this.playingSounds={}};WebAudioAPISoundManager.prototype={addSound:function(url){if(isWebAudioAPIEnabled){var request=new XMLHttpRequest;request.open("GET",url,!0),request.responseType="arraybuffer";var self=this;request.onload=function(){self.context.decodeAudioData(request.response,function(buffer){buffer&&(self.bufferList[url]=buffer,$.assetLoaded())},function(e){})},request.onerror=function(){alert("BufferLoader: XHR error")},request.send()}else{var audio=new Audio;!0===audio.canPlayType("audio/ogg")?audioType="ogg":audioType="mp3",audio.setAttribute("type","audio/"+audioType),audio.setAttribute("src",url.replace(".mp3","."+audioType)),audio.addEventListener("canplaythrough",function(){Config.assetLoaded()},!1),this.bufferList[url.split("/").pop()]=audio}},stopSoundWithUrl:function(url){if(this.playingSounds.hasOwnProperty(url))for(var i in this.playingSounds[url])this.playingSounds[url].hasOwnProperty(i)&&this.playingSounds[url][i].noteOff(0)}};var Sound=function(url,options){this.settings={loop:!1};for(var i in options)options.hasOwnProperty(i)&&(this.settings[i]=options[i]);this.url=url+".wav",window.webAudioAPISoundManager=window.webAudioAPISoundManager||new WebAudioAPISoundManager(window.audioContext),this.manager=window.webAudioAPISoundManager,this.manager.addSound(this.url)};Sound.prototype={play:function(){if(isWebAudioAPIEnabled){var buffer=this.manager.bufferList[this.url];if(void 0!==buffer){var source=this.makeSource(buffer);source.loop=this.settings.loop,source.start(0),this.manager.playingSounds.hasOwnProperty(this.url)||(this.manager.playingSounds[this.url]=[]),this.manager.playingSounds[this.url].push(source)}}else this.manager.bufferList[this.url.split("/").pop()].play()},stop:function(){isWebAudioAPIEnabled?this.manager.stopSoundWithUrl(this.url):this.manager.bufferList[this.url.split("/").pop()].stop()},getVolume:function(){return this.translateVolume(this.volume,!0)},setVolume:function(volume){this.volume=this.translateVolume(volume)},translateVolume:function(volume,inverse){return inverse?100*volume:volume/100},makeSource:function(buffer){var source=this.manager.context.createBufferSource(),gainNode=this.manager.context.createGain();return gainNode.gain.value=1,source.buffer=buffer,source.connect(gainNode),gainNode.connect(this.manager.context.destination),source}},SimpleImage=function(args){args=args||{},this.x=args.x||0,this.y=args.y||0,this.image=$.imageAssets[args.image]||new Image,this.width=this.image.width,this.height=this.image.height,this.anchor={x:$.anchor.LEFT,y:$.anchor.TOP},this.draw=function(){$.offContext.drawImage(this.image,this.x-this.image.width*this.anchor.x,this.y-this.image.height*this.anchor.y)},this.update=function(){}},Sprite=function(args){args=args||{},this.x=args.x||0,this.y=args.y||0,this.spriteSheet=$.imageAssets[args.spriteSheet]||new Image,this.frameW=args.frameWidth,this.frameH=args.frameHeight,this.frame=0,this.moving=!1,this.anchor={x:$.anchor.LEFT,y:$.anchor.TOP},this.frameQX=this.spriteSheet.width/this.frameW,this.frameQY=this.spriteSheet.height/this.frameH,this.draw=function(){this.offsetX=Math.floor(this.frame%this.frameQX)*this.frameW,this.offsetY=Math.floor(this.frame/this.frameQX)*this.frameH,$.offContext.drawImage(this.spriteSheet,this.offsetX,this.offsetY,this.frameW,this.frameH,this.x-this.frameW*this.anchor.x,this.y-this.frameH*this.anchor.y,this.frameW,this.frameH)},this.update=function(){},this.kill=function(){$.currentSceneObjects.splice($.currentSceneObjects.indexOf(this),1)}},Button=function(args){args=args||{},this.x=args.x||0,this.y=args.y||0,this.image=$.imageAssets[args.image]||new Image,this.width=this.image.width,this.height=this.image.height,this.anchor={x:$.anchor.LEFT,y:$.anchor.TOP},this.draw=function(){$.offContext.drawImage(this.image,this.x-this.image.width*this.anchor.x,this.y-this.image.height*this.anchor.y)},this.update=function(){},this.on=function(event,callback,context){$.currentSceneEvents.push([this,event,callback,context])},this.isInside=function(pos){var x=pos.pageX-$.canvas.offsetLeft,y=pos.pageY-$.canvas.offsetTop,bx=(this.x-this.image.width*this.anchor.x)*$.canvasRatio,by=(this.y-this.image.height*this.anchor.y)*$.canvasRatio;return x>=bx&&x<=bx+this.width*$.canvasRatio&&y<=by+this.height*$.canvasRatio&&y>=by}},Text=function(args){args=args||{},this.text=args.text||"",this.x=args.x||0,this.y=args.y||0,this.size=args.size||1,this.color=args.color||"#000000",this.letters={A:[[,1],[1,,1],[1,,1],[1,1,1],[1,,1]],B:[[1,1],[1,,1],[1,1,1],[1,,1],[1,1]],C:[[1,1,1],[1],[1],[1],[1,1,1]],D:[[1,1],[1,,1],[1,,1],[1,,1],[1,1]],E:[[1,1,1],[1],[1,1,1],[1],[1,1,1]],F:[[1,1,1],[1],[1,1],[1],[1]],G:[[,1,1],[1],[1,,1,1],[1,,,1],[,1,1]],H:[[1,,1],[1,,1],[1,1,1],[1,,1],[1,,1]],I:[[1,1,1],[,1],[,1],[,1],[1,1,1]],J:[[1,1,1],[,,1],[,,1],[1,,1],[1,1,1]],K:[[1,,,1],[1,,1],[1,1],[1,,1],[1,,,1]],L:[[1],[1],[1],[1],[1,1,1]],M:[[1,1,1,1,1],[1,,1,,1],[1,,1,,1],[1,,,,1],[1,,,,1]],N:[[1,,,1],[1,1,,1],[1,,1,1],[1,,,1],[1,,,1]],O:[[1,1,1],[1,,1],[1,,1],[1,,1],[1,1,1]],P:[[1,1,1],[1,,1],[1,1,1],[1],[1]],Q:[[0,1,1],[1,,,1],[1,,,1],[1,,1,1],[1,1,1,1]],R:[[1,1],[1,,1],[1,,1],[1,1],[1,,1]],S:[[1,1,1],[1],[1,1,1],[,,1],[1,1,1]],T:[[1,1,1],[,1],[,1],[,1],[,1]],U:[[1,,1],[1,,1],[1,,1],[1,,1],[1,1,1]],V:[[1,,,,1],[1,,,,1],[,1,,1],[,1,,1],[,,1]],W:[[1,,,,1],[1,,,,1],[1,,,,1],[1,,1,,1],[1,1,1,1,1]],X:[[1,,,,1],[,1,,1],[,,1],[,1,,1],[1,,,,1]],Y:[[1,,1],[1,,1],[,1],[,1],[,1]],Z:[[1,1,1,1,1],[,,,1],[,,1],[,1],[1,1,1,1,1]],0:[[1,1,1],[1,,1],[1,,1],[1,,1],[1,1,1]],1:[[,1],[,1],[,1],[,1],[,1]],2:[[1,1,1],[0,0,1],[1,1,1],[1,0,0],[1,1,1]],3:[[1,1,1],[0,0,1],[1,1,1],[0,0,1],[1,1,1]],4:[[1,0,1],[1,0,1],[1,1,1],[0,0,1],[0,0,1]],5:[[1,1,1],[1,0,0],[1,1,1],[0,0,1],[1,1,1]],6:[[1,1,1],[1,0,0],[1,1,1],[1,0,1],[1,1,1]],7:[[1,1,1],[0,0,1],[0,0,1],[0,0,1],[0,0,1]],8:[[1,1,1],[1,0,1],[1,1,1],[1,0,1],[1,1,1]],9:[[1,1,1],[1,0,1],[1,1,1],[0,0,1],[1,1,1]]," ":[[,,],[,,],[,,],[,,],[,,]],"?":[[1,1,1],[0,0,1],[0,1,0],[0,0,0],[0,1,0]]},this.draw=function(){var needed=[];string=this.text.toUpperCase();for(var i=0;i<string.length;i++){var letter=this.letters[string.charAt(i)];letter&&needed.push(letter)}$.offContext.fillStyle=this.color;var currX=this.x;for(i=0;i<needed.length;i++){letter=needed[i];for(var currY=this.y,addX=0,y=0;y<letter.length;y++){for(var row=letter[y],x=0;x<row.length;x++)row[x]&&$.offContext.fillRect(currX+x*this.size,currY,this.size,this.size);addX=Math.max(addX,row.length*this.size),currY+=this.size}currX+=this.size+addX}},this.update=function(){}},Tween=function(target,args,context){args=args||{},this.target=target||null,this.newx=args.x||null,this.newy=args.y||null,this.context=context||null,this.startTime=(new Date).getTime(),this.started=!1,this.finished=!1,this.onDone=null,this.draw=function(){},this.update=function(){if(!this.finished){var time=(new Date).getTime()-this.startTime;if(null!=this.newx){var newx=(linearSpeed=this.newx/this.target.x)*time/1e3;this.newx>this.target.x?this.target.x+=Math.ceil(newx):this.target.x==Math.ceil(this.newx)&&(this.finished=!0),this.newx<this.target.x?this.target.x-=Math.ceil(newx):this.target.x==Math.ceil(this.newx)&&(this.finished=!0)}if(null!=this.newy){var linearSpeed=this.newy/this.target.y,newy=linearSpeed*time/1e3;this.newy>this.target.y?this.target.y+=Math.ceil(newy):this.target.y==Math.ceil(this.newy)&&(this.finished=!0),this.newy<this.target.y?this.target.y-=Math.ceil(newy):this.target.y==Math.ceil(this.newy)&&(this.finished=!0)}this.finished&&null!=this.onDone&&this.onDone.call($.currentScene)}}},$=new function(){this.version="0.1b",this.title="",this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.offCanvas=document.createElement("canvas"),this.offContext=this.offCanvas.getContext("2d"),this.defaultHeight=0,this.defaultWidth=0,this.centerX=0,this.centerY=0,this.bgColor=null,this.orientation="portrait",this.time={now:Date.now(),delta:Date.now(),then:Date.now(),interval:1e3/60,fps:60},this.assets={files:[],sounds:[],images:[]},this.assetsToLoad=0,this.assetsLoaded=0,this.loadComplete=!1,this.fileAssets=[],this.imageAssets=[],this.soundAssets=[],this.currentScene=null,this.currentSceneObjects=[],this.currentSceneAnimations=[],this.currentSceneEvents=[],this.anchor={LEFT:0,TOP:0,CENTER:.5,RIGHT:1,BOTTOM:1},this.onReady=function(args){window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(callback,element){window.setTimeout(callback,100)},this.isFunction(args)&&(window.onload=args)},this.setup=function(args){var appStyles=document.createElement("style");appStyles.innerHTML="*{margin:0px; padding:0px; border:0px; overflow: hidden;} canvas{padding:0px; margin:0px; border: 0px;}",this.title=args.title||"API",this.author=args.author||"API_NAME",this.description=args.description||"API DESCRIPTION",this.canvas.width=args.width||320,this.canvas.height=args.height||480,this.offCanvas.width=this.canvas.width,this.offCanvas.height=this.canvas.height,this.defaultWidth=this.canvas.width,this.defaultHeight=this.canvas.height,this.centerX=Math.round(this.canvas.width/2),this.centerY=Math.round(this.canvas.height/2),this.orientation=args.orientation||"portrait",this.time.fps=args.fps||60,args.pixelart&&(appStyles.innerHTML+=" canvas { image-rendering: optimizeSpeed; image-rendering: -moz-crisp-edges; image-rendering: -o-crisp-edges; image-rendering: -webkit-optimize-contrast; image-rendering: optimize-contrast; image-rendering: crisp-edges; image-rendering: pixelated; -ms-interpolation-mode: nearest-neighbor;}"),this.bgColor=args.bgColor||null,this.assets.files=args.assets.files||[],this.assets.sounds=args.assets.sounds||[],this.assets.images=args.assets.images||[],void 0==this.assets.sounds&&this.assets.images;var appTitle=document.createElement("title");appTitle.innerHTML=this.title;var metaAuthor=document.createElement("meta");metaAuthor.setAttribute("author",this.author);var metaDescription=document.createElement("meta");metaDescription.setAttribute("description",this.description);var metaCache=document.createElement("meta");metaCache.setAttribute("http-equiv","Cache-Control"),metaCache.setAttribute("content","no-cache, no-store, must-revalidate");var metaPragma=document.createElement("meta");metaPragma.setAttribute("http-equiv","Pragma"),metaPragma.setAttribute("content","no-cache");var metaExpires=document.createElement("meta");metaExpires.setAttribute("http-equiv","Expires"),metaExpires.setAttribute("content","0");var metaView=document.createElement("meta");metaView.setAttribute("name","viewport"),metaView.setAttribute("content","width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"),document.head.appendChild(appStyles),document.head.appendChild(appTitle),document.head.appendChild(metaAuthor),document.head.appendChild(metaDescription),document.head.appendChild(metaCache),document.head.appendChild(metaPragma),document.head.appendChild(metaExpires),document.head.appendChild(metaView),document.body.appendChild(this.canvas),window.addEventListener("resize",this.resizeScreen.bind(this),!1),this.canvas.addEventListener("touchstart",function(event){for(var i=0;i<$.currentSceneEvents.length;i++)"touchstart"==$.currentSceneEvents[i][1]&&$.currentSceneEvents[i][0].isInside(event)&&$.currentSceneEvents[i][2].call($.currentSceneEvents[i][3],$.currentSceneEvents[i][0])},!1),this.canvas.addEventListener("touchend",function(event){for(var i=0;i<$.currentSceneEvents.length;i++)"touchend"==$.currentSceneEvents[i][1]&&$.currentSceneEvents[i][0].isInside(event)&&$.currentSceneEvents[i][2].call($.currentSceneEvents[i][3],$.currentSceneEvents[i][0])},!1),this.canvas.addEventListener("mousedown",function(event){for(var i=0;i<$.currentSceneEvents.length;i++)"mousedown"==$.currentSceneEvents[i][1]&&$.currentSceneEvents[i][0].isInside(event)&&$.currentSceneEvents[i][2].call($.currentSceneEvents[i][3],$.currentSceneEvents[i][0])},!1),this.canvas.addEventListener("mouseup",function(event){for(var i=0;i<$.currentSceneEvents.length;i++)"mouseup"==$.currentSceneEvents[i][1]&&$.currentSceneEvents[i][0].isInside(event)&&$.currentSceneEvents[i][2].call($.currentSceneEvents[i][3],$.currentSceneEvents[i][0])},!1),this.canvas.addEventListener("click",function(event){for(var i=0;i<$.currentSceneEvents.length;i++)"click"==$.currentSceneEvents[i][1]&&$.currentSceneEvents[i][0].isInside(event)&&$.currentSceneEvents[i][2].call($.currentSceneEvents[i][3],$.currentSceneEvents[i][0])},!1),this.resizeScreen(),this.loadAssets(),this.main()},this.main=function(){this.time.now=Date.now(),this.time.delta=this.time.now-this.time.then,this.time.delta>this.time.interval&&(this.time.then=this.time.now-this.time.delta%this.time.interval,this.update(),this.draw()),requestAnimationFrame(this.main.bind(this))},this.update=function(){if(this.currentScene){for(i=0;i<this.currentSceneObjects.length;i++);for(i=0;i<this.currentSceneAnimations.length;i++)this.currentSceneAnimations[i].finished?this.currentSceneAnimations.splice(i,1):this.currentSceneAnimations[i].update();for(var i=0;i<this.currentSceneAnimations.length;i++)this.currentSceneAnimations[i].finished&&this.currentSceneAnimations.splice(i,1);this.currentScene.update()}},this.draw=function(){this.bgColor?(this.offContext.fillStyle=this.bgColor,this.offContext.fillRect(0,0,this.offCanvas.width,this.offCanvas.height)):this.offContext.clearRect(0,0,this.offCanvas.width,this.offCanvas.height);for(var i=0;i<this.currentSceneObjects.length;i++)this.currentSceneObjects[i].draw();this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.drawImage(this.offCanvas,0,0)},this.loadAssets=function(callback){for(this.assetsToLoad=(this.assets.files.length||0)+(this.assets.sounds.length||0)+(this.assets.images.length||0),i=0;i<this.assets.files.length;i++);for(i=0;i<this.assets.sounds.length;i++)this.soundAssets[this.assets.sounds[i].split("/").pop().replace(/\.[^/.]+$/,"")]=new Sound(this.assets.sounds[i]);for(var i=0;i<this.assets.images.length;i++){var img=new Image;img.addEventListener("load",this.assetLoaded.bind(this)),img.src=this.assets.images[i];var key=this.assets.images[i].split("/").pop();this.imageAssets[key.replace(/\.[^/.]+$/,"")]=img}},this.assetLoaded=function(){++this.assetsLoaded>=this.assetsToLoad&&(this.loadComplete=!0)},this.goTo=function(value,args){this.currentSceneObjects=[],this.currentSceneEvents=[],this.currentScene=null,this.currentScene=value,this.currentScene.init(args)},this.resizeScreen=function(){var actualWidth=window.innerWidth,actualHeight=window.innerHeight;if("portrait"==this.orientation){this.canvas.height=Math.ceil(actualHeight*this.defaultWidth/actualWidth);var heightToWidth=this.canvas.height/this.canvas.width,newWidth=window.innerWidth;(newHeight=window.innerHeight)/newWidth>heightToWidth?(newheight=newWidth*heightToWidth,this.canvas.style.height=newHeight+"px",this.canvas.style.width=newWidth+"px"):(newWidth=newHeight/heightToWidth,this.canvas.style.width=newWidth+"px",this.canvas.style.height=newHeight+"px"),this.canvas.style.height=newHeight}else{this.canvas.width=Math.ceil(actualWidth*this.defaultHeight/actualHeight);var widthToHeight=this.canvas.width/this.canvas.height,newWidth=window.innerWidth,newHeight=window.innerHeight;newWidth/newHeight>widthToHeight?(newWidth=newHeight*widthToHeight,this.canvas.style.height=newHeight+"px",this.canvas.style.width=newWidth+"px"):(newHeight=newWidth/widthToHeight,this.canvas.style.width=newWidth+"px",this.canvas.style.height=newHeight+"px"),this.canvas.style.width=newWidth}this.offCanvas.width=this.canvas.width,this.offCanvas.height=this.canvas.height,this.canvas.width=this.canvas.width,this.canvas.height=this.canvas.height,this.canvas.style.width=this.canvas.style.width,this.canvas.style.height=this.canvas.style.height,this.canvasRatio=parseInt(this.canvas.style.width)/this.defaultWidth,this.centerX=Math.round(this.canvas.width/2),this.centerY=Math.round(this.canvas.height/2)},this.isColliding=function(shapeA,shapeB,callback){shapeA.x<shapeB.x+shapeB.width&&shapeA.x+shapeA.width>shapeB.x&&shapeA.y<shapeB.y+shapeB.height&&shapeA.y+shapeA.height>shapeB.y&&callback(shapeA,shapeB)},this.on=function(strEvent,obj,fncName){"string"==typeof strEvent&&this.isFunction(fncName)&&obj.addEventListener(strEvent,fncName)},this.defaultClickEvent=function(event){event.preventDefault(),this.screenRatio=parseInt(this.canvas.style.width)/this.canvas.width,"touchstart"==event.type?(this.input.x=event.targetTouches[0].pageX-parseInt(this.canvas.offsetLeft),this.input.y=event.targetTouches[0].pageY-parseInt(this.canvas.offsetTop)):(this.input.x=event.pageX-parseInt(this.canvas.offsetLeft),this.input.y=event.pageY-parseInt(this.canvas.offsetTop))},this.rand=function(min,max){return Math.floor(Math.random()*(max-min+1)),Math.floor(Math.random()*(max-min+1)),Math.floor(Math.random()*(max-min+1))+min},this.isFunction=function(value){return"function"==typeof value},this.image=function(posX,posY,imgName){var temp=this.currentSceneObjects.length;return this.currentSceneObjects.push(new SimpleImage({x:posX,y:posY,image:imgName},this)),this.currentSceneObjects[temp]},this.sprite=function(posX,posY,sprName,frameWidth,frameHeight){var temp=this.currentSceneObjects.length;return this.currentSceneObjects.push(new Sprite({x:posX,y:posY,spriteSheet:sprName,frameWidth:frameWidth,frameHeight:frameHeight},this)),this.currentSceneObjects[temp]},this.button=function(posX,posY,imgName){var temp=this.currentSceneObjects.length;return this.currentSceneObjects.push(new Button({x:posX,y:posY,image:imgName},this)),this.currentSceneObjects[temp]},this.text=function(posX,posY,string,size,color){var temp=this.currentSceneObjects.length;return this.currentSceneObjects.push(new Text({x:posX,y:posY,text:string,size:size,color:color},this)),this.currentSceneObjects[temp]},this.tween=function(target,args){var temp=this.currentSceneAnimations.length;return this.currentSceneAnimations.push(new Tween(target,args,this)),this.currentSceneAnimations[temp]}};